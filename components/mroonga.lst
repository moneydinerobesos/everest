$require groonga.lst
$require mysql.lst
$set MYSQL_VERSION 5.6.26
$download http://cdn.mysql.com/Downloads/MySQL-5.6/mysql-$(MYSQL_VERSION).tar.gz
$exec "cd /root && tar zxvf /tmp/download/mysql-*.tar.gz"
$exec --overlay "cd /root/mysql-* && cmake . && cd libservices && make && mv libmysqlservices.a /usr/lib/"
$download http://packages.groonga.org/source/mroonga/mroonga-5.05.tar.gz
$exec "cd /root && tar zxvf /tmp/download/mroonga-*.tar.gz"
$exec --overlay "cd /root/mroonga-* && ./configure --with-mysql-source=/root/mysql-$(MYSQL_VERSION) && make && make install"

$mkdir /tmp/mysql
$write /tmp/mysql/initial_database.sql "INSTALL PLUGIN mroonga SONAME 'ha_mroonga.so';"
$write --append /tmp/mysql/initial_database.sql "CREATE FUNCTION last_insert_grn_id RETURNS INTEGER soname 'ha_mroonga.so';"
$write --append /tmp/mysql/initial_database.sql "CREATE FUNCTION mroonga_snippet RETURNS STRING soname 'ha_mroonga.so';"
$write --append /tmp/mysql/initial_database.sql "CREATE FUNCTION mroonga_command RETURNS STRING soname 'ha_mroonga.so';"
$copy mysql/operate.sh /tmp/mysql/operate.sh
$exec "/tmp/mysql/operate.sh exec mysql 'source /tmp/mysql/initial_database.sql'"
$exec "rm -rf /root/mroonga-* /root/mysql-*"

