$require domU.lst
$require domU-overlayfs-kernel.lst
$sed /etc/conf.d/hostname 's/^\(hostname="\).*\("\)$/\1docker\2/'
$write --append /etc/fstab "/.overlay/data01 /var/lib/docker none bind 0 0"

$package sys-fs/aufs-util
$package dev-lang/go
$require perl.lst # for shasum command
#$package dev-go/sanitized-anchor-name
#$package dev-go/blackfriday
#$package dev-go/go-md2man
#dev-db/sqlite

$require s3cmd.lst

#sys-libs/libseccomp
#app-emulation/runc
$package app-emulation/containerd

$package net-firewall/iptables
$require git.lst
$package app-emulation/docker --use="aufs overlay -device-mapper"
$package app-emulation/docker-proxy
$mkdir /var/lib/docker
$symlink /etc/runlevels/default/docker /etc/init.d/docker

$require nodejs.lst
$exec "npm install -g grunt-cli"

# docker ui
#$exec --overlay "cd /root && git clone https://github.com/crosbymichael/dockerui.git && cd dockerui && npm install"
#$copy docker/dockerui.init /etc/init.d/dockerui
#$symlink /etc/runlevels/default/dockerui /etc/init.d/dockerui

# nginx
$require nginx.lst
$write /etc/nginx/proxy.map "aipo.example.com http://aipo.local;\nowncloud.example.com http://owncloud.local;"
$copy revproxy/nginx.conf /etc/nginx/nginx.conf
$copy revproxy/proxy.conf /etc/nginx/proxy.conf
$mkdir /etc/ssl/nginx
$exec "openssl genrsa 2048 > /etc/ssl/nginx/nginx.key"
$exec "openssl req -new -subj /CN=www.example.com -key /etc/ssl/nginx/nginx.key | openssl x509 -days 3650 -req -signkey /etc/ssl/nginx/nginx.key > /etc/ssl/nginx/nginx.pem"

$vadesc
