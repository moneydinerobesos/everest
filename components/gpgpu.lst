$require base.lst

$dir /lib/firmware
$require kbd-minimal.lst
$require zram-init.lst
$require acpi.lst

#install script
$package dosfstools
$package parted
$require grub-i386-pc.lst
$copy resource/walbrix/install /usr/sbin/

/bin/ip
/usr/bin/awk
$copy resource/walbrix/adhoc-sshd /usr/sbin/

$mkdir /boot/grub
$copy resource/gpgpu/grub.cfg /boot/grub/grub.cfg

#hwids
/bin/sed
/usr/sbin/lspci
/usr/share/misc/pci.ids.gz
/usr/share/misc/usb.ids.gz

$copy resource/walbrix/save /sbin/save

$sed /boot/grub/grub.cfg "s/__VERSION__/$WALBRIX_VERSION/g"
$copy resource/gpgpu/net /etc/conf.d/

$require wpa_supplicant.lst
$symlink /etc/init.d/net.wlan0 net.lo
$copy resource/walbrix/setup-wifi /usr/sbin/

$package app-misc/ca-certificates
$package app-misc/mime-types
$package app-misc/pax-utils
$require openssl.lst
$package net-misc/wget
$package sys-apps/haveged

#$require s3cmd.lst
$package sys-apps/dmidecode

$sed /etc/conf.d/hostname 's/^hostname=".\+"/hostname="gpgpu"/' # set default hostname

# extend capacity
$write /etc/sysctl.d/nf_conntrack_max.conf 'net.nf_conntrack_max = 65536'
$write /etc/sysctl.d/nr_hugepages.conf 'vm.nr_hugepages=1280'

$require acpi.lst
$package sys-apps/gptfdisk
/usr/bin/lsscsi

# networks
$require nss-mdns.lst
$require nss-myhostname.lst
$package net-analyzer/traceroute
$require wireless-tools.lst
$require tcpdump.lst
$require ssmtp.lst
#$require cu.lst
$require ntp.lst
/usr/bin/curl
/sbin/brctl

# tools
/usr/bin/strace
/usr/bin/telnet
$package screen

# hardware
/etc/udev/hwdb.bin
/usr/bin/beep
/usr/bin/cpuid2cpuflags
$package usbutils
$package lm-sensors
$package cpupower
$package lshw
$require intel-neo.lst
$require gpsd.lst
/usr/bin/clinfo

# drivers
$package nvidia-drivers --no-elf-cache
#$package amdgpu-pro-opencl
$package dev-libs/rocm-opencl-runtime
$package dev-libs/rocm-device-libs
$package dev-libs/rocm-comgr
#dev-libs/rocr-runtime

# misc
$package ocl-icd
#$exec --overlay "eselect opencl set ocl-icd"
/usr/lib64/libuv.so.1
/usr/lib64/libdrm.so.2
/usr/lib64/libdrm_amdgpu.so.1
/usr/lib64/libmicrohttpd.so.12
/usr/lib64/libhwloc.so.5
/usr/share/libdrm/amdgpu.ids

# node
#$require ts-node.lst

$require timezone-jp.lst

#$exec --overlay "env-update"
#$deltree /var/lib/portage

$copy resource/gpgpu/update /usr/sbin/
$copy resource/walbrix/setup-data-partition /usr/sbin/
$copy resource/gpgpu/wait-for-network-to-be-connected /usr/bin/

$exec ldconfig
